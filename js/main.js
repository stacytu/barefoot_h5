/*
此专题出自澎湃新闻网，http://thepaper.cn @date 2017-04-23
contact us：lintao@thepaper.cn
*/
!function(){var f,j,k,g,h,i,a=window.TP||{},b=/iPad|iPod|iPhone|Android/.test(navigator.userAgent),c=$(window),d=c.width(),e=c.height();b||(d=600),f=d/.893,g=$("#loadcount"),h=document.getElementById("voicebg"),i=document.getElementById("voicep2v"),a.tianqu={init:function(){$(".cover-video").css({"-webkit-transform":"scale("+d/750+")",transform:"scale("+d/750+")"}),$("#scroller2").width(8*d).height(f),$("#g1").height(f).find(".slide").width(d).height(f),$(".p1").on("touchstart tap",function(a){a.preventDefault(),h.play()}),$("#geyao").on("touchstart tap",function(a){a.preventDefault(),i.play(),h.pause()}),$(".p5").on("touchstart tap",function(a){a.preventDefault(),i.pause(),h.play()}),$(".p4 .exlink").on("touchstart tap","a",function(a){var b,c;a.preventDefault(),b=$(this),c=b.attr("id"),$("#voicebg"+c).addClass("showlayer"),$("#voice"+c)[0].play()}),$(".p16 .exlink").on("touchstart tap","a",function(a){var b,c;a.preventDefault(),b=$(this),c=b.attr("id"),j=$("#videoP15").find("video")[0],$("#voicebg"+c).addClass("showlayer"),$("#voicet"+c).addClass("showlayer").siblings().removeClass("showlayer"),h.pause(),j.pause(),$("#voice"+c)[0].play(),$("#voice"+c).siblings().each(function(){this.pause()}),$("#voicebgp16e").removeClass("showlayer")}),$("#p16e").on("touchstart tap",function(a){var b,c;a.preventDefault(),b=$(this),c=b.attr("id"),$(".p16 .tbox img").removeClass("showlayer"),$("#voicebg"+c).addClass("showlayer").siblings().removeClass("showlayer"),$("#v16box audio").each(function(){this.pause()}),h.play()}),$(".p11 .exlink").on("touchstart tap","a",function(b){b.preventDefault();var c=$(this);c.parent().addClass("hide"),a.tianqu.loadPano()}),$(".close-pano").on("touchstart mouseup",function(){$(".panowrap").fadeOut("slow"),$(".p11 .mimg").addClass("show-mimg")}),$("#scroller2 .slide").on("touchstart mouseup",function(){setTimeout(function(){$(".tips-swipe").fadeOut("slow")},1500)}),document.addEventListener("touchmove",function(a){a.preventDefault()},!1)},initIscroll:function(){k=new IScroll("#container",{probeType:3,mouseWheel:!0,scrollX:!1,scrollY:!0,bounce:!1,tap:!0,scrollbars:!0}),k.on("scroll",a.tianqu.updatePosition),k.on("scrollEnd",a.tianqu.updatePosition);var b;b=new IScroll("#g1",{scrollX:!0,scrollY:!1,momentum:!1,bounce:!1,snap:!0,indicators:{el:document.getElementById("g1pos"),resize:!1}})},updatePosition:function(){var b,c,d,a=this.y>>0;-a>60&&e>-a&&$(".m1").css({"transition-duration":"200ms","-webkit-transform":"translate3d(0,"+-(a+60)+"px,0)",transform:"translate3d(0,"+-(a+60)+"px,0)"}),-a>e/2&&2*e>-a?($(".p2").addClass("active"),$(".m2").css({"transition-duration":"200ms","-webkit-transform":"translate3d(0,"+-(a+e/2)+"px,0)",transform:"translate3d(0,"+-(a+e/2)+"px,0)"})):$(".p2").removeClass("active"),-a>e+e/2&&3*e>-a?($(".p3").addClass("active"),$(".m3").css({"transition-duration":"200ms","-webkit-transform":"translate3d(0,"+-(a+e+e/2)+"px,0)"})):$(".p3").removeClass("active"),-a>2*e+e/2&&4*e+e/2>-a?$(".p4").addClass("active"):$(".p4").removeClass("active"),-a>3*e+e/3&&5*e+e/2>-a?($(".p5").addClass("active"),$(".m5").css({"transition-duration":"200ms","-webkit-transform":"translate3d(0,"+-(a+3*e+e/2)/10+"px,0)"})):$(".p5").removeClass("active"),-a>4*e+e/3&&6*e>-a?($(".p6").addClass("active"),$(".p6 .mbox").eq(0).css({"transition-duration":"200ms","-webkit-transform":"translate3d(0,"+-(a+4*e+e/2)/10+"px,0)"}),$(".p6 .mbox").eq(1).css({"transition-duration":"200ms","-webkit-transform":"translate3d(0,"+-(a+4*e+e/2)/20+"px,0)"})):$(".p6").removeClass("active"),-a>5*e+e/3&&7*e>-a?($(".p7").addClass("active"),$(".m7").css({"transition-duration":"200ms","-webkit-transform":"translate3d(0,"+-(a+5*e+e/2)+"px,0)"})):$(".p7").removeClass("active"),-a>6*e+e/2&&7*e+e/5>-a?(b=(-a-(6*e+e/2))/(7*e+e/5-(6*e+e/2)),c=Math.round(10*b)/10+1,$(".p8").addClass("active"),$(".m8").css({"transition-duration":"200ms","-webkit-transform":"scale("+c+","+c+")"})):$(".p8").removeClass("active"),-a>7*e+e/3&&9*e+e/2>-a?($(".p9").addClass("active"),$(".m9").css({"transition-duration":"200ms","-webkit-transform":"translate3d(0,"+-(a+7*e+e/2)+"px,0)"})):$(".p9").removeClass("active"),-a>8*e+e/3&&10*e+e/2>-a?$(".p10").addClass("active"):($(".p10").removeClass("active"),$(".tips-swipe").fadeIn()),-a>9*e+2*e/3&&11*e>-a?$(".p11").addClass("active"):($(".p11").removeClass("active"),$(".p11 .exlink").removeClass("hide"),$(".p11 .mimg").removeClass("show-mimg")),-a>10*e+e/3&&12*e+e/2>-a?($(".p12").addClass("active"),$(".m12").css({"transition-duration":"200ms","-webkit-transform":"translate3d(0,"+-(a+10*e+e/2)+"px,0)"})):$(".p12").removeClass("active"),-a>11*e+e/3&&13*e+e/2>-a?$(".p13").addClass("active"):$(".p13").removeClass("active"),-a>12*e+e/2&&14*e+e/2>-a?$(".p14").addClass("active"):$(".p14").removeClass("active"),-a>13*e+e/3&&15*e+e/2>-a?$(".p15").addClass("active"):($(".p15").removeClass("active"),d=$("#videoP15").find("video")[0],d.pause()),-a>14*e+e/3&&16*e+e/2>-a?($(".p16").addClass("active"),$(".m16").css({"transition-duration":"200ms","-webkit-transform":"translate3d(0,"+-(a+14*e+e/2)+"px,0)"})):$(".p16").removeClass("active"),-a>15*e+e/3&&17*e+e/2>-a?($(".p17").addClass("active"),$(".m17").css({"transition-duration":"200ms","-webkit-transform":"translate3d(0,"+-(a+15*e+e/2)+"px,0)"})):$(".p17").removeClass("active")},loadQueue:function(){var b=new createjs.LoadQueue;b.on("complete",a.tianqu.afterLoder,this),b.loadManifest([{id:"loadpage",src:"img/bg-loading.jpg"},{id:"cover-video",src:"img/cover-video.jpg"}]),b.on("fileload",function(a){var b=a.item,c=a.result,d=c.src;"aimg1"==b.id||"aimg2"==b.id||"aimg3"==b.id||"aimg4"==b.id||"aimg5"==b.id||"aimg6"==b.id||"aimg7"==b.id||"aimg8"==b.id||"aimg9"==b.id?$("."+b.id).attr("src",d):"image"==b.type&&$("."+b.id).css("background-image","url("+d+")")},this),b.on("progress",function(){var a=Math.round(100*b.progress);g.text(a)})},afterLoder:function(){$("#loading").animate({opacity:0},1e3,function(){$(this).addClass("hide"),$(".p1").addClass("active"),setTimeout(function(){$(".covert").fadeOut()},4e3)})},loadPano:function(){var a=document.getElementById("krpanoSWFObject");a||embedpano({swf:"360/sources/tour.swf",xml:"360/sources/tour.xml",target:"pano",wmode:"transparent",html5:"auto",passQueryParameters:!0}),$(".panowrap").fadeIn("slow")},initVideo:function(){var a=$(".videobox");a.each(function(a,b){var e,f,g,i,l,c=$(b).attr("id"),d=$(b);d.append('<div class="poster"><img src="img/'+c+'.jpg" /></div><video poster="img/'+c+'.jpg" src="img/'+c+'.mp4" playsinline webkit-playsinline preload="auto" /></video>'+'<div class="playpause">'+'<button class="btn-play"><span>play</span></button>'+'<button class="btn-pause hide"><span>pause</span></button></div>'+'<div class="controlbar">'+'<div class="progressbar"><div class="timetip hide"></div>'+'<progress max="100" value="0"></progress></div></div>'),e=d.find("video"),f=d.find(".poster"),g=d.find(".playpause"),i=d.find("progress"),d.find(".px-seconds"),d.find(".timetip"),d.on("click touchstart",".btn-play",function(a){a.preventDefault();var b=$(this);h.pause(),$("#v16box audio").each(function(){this.pause()}),e[0].play(),f.addClass("hide"),d.addClass("active"),b.addClass("hide").next().removeClass("hide").focus().parent().css({opacity:"0","-webkit-transition":"opacity 1s ease",transition:"opacity 1s ease"})}),d.on("click touchstart",".btn-pause",function(a){a.preventDefault();var b=$(this);e[0].pause(),d.removeClass("active"),b.addClass("hide").prev().removeClass("hide").focus().parent().css({opacity:"1"})}),d.on("mouseenter",function(){d.is(".active")&&g.css("opacity","1")}),d.on("mouseleave",function(){d.is(".active")&&g.css({opacity:"0"})}),e.each(function(a,b){$(b).on("pause",function(){$(b).next().find(".btn-pause").addClass("hide").prev().removeClass("hide").focus().parent().css("opacity","1")})}),l={},e.on("timeupdate",function(){l.secs=parseInt(e[0].currentTime%60),l.mins=parseInt(e[0].currentTime/60%60),l.secs=("0"+l.secs).slice(-2),l.mins=("0"+l.mins).slice(-2),l.percent=100/e[0].duration*e[0].currentTime,l.percent>0&&i.val(l.percent)})})}},$(document).ready(function(){a.tianqu.init(),a.tianqu.initVideo(),a.tianqu.initIscroll(),a.tianqu.loadQueue()})}();